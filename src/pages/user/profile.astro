---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Mi Perfil üí™üèª">
  <div
    class="bg-gradient-to-br from-[#554732] to-black h-screen w-screen flex flex-col items-center justify-center text-white"
  >
    <h3 class="mt-24">Bienvenido a tu perfil en SrMaca!. üí™üèª</h3>
    <div class="flex overflow-hidden">
      <section id="info-container"></section>
      <section id="voucher-container" class="grid grid-cols-3 gap-4 overflow-y-auto"></section> 
    </div>
  </div>
</Layout>

<!-- Logica de la pagina -->
<script>
  import formatDate from "../../utils/FormatDate.js";

  import getCookie from "../../utils/GetCookie";

  const infoContainer = document.getElementById("info-container");
  const token = getCookie("Auth");
  console.log(token);

  const voucherContainer = document.getElementById("voucher-container");
  async function GetUser() {
    // const response = await fetch("http://localhost:8080/user/", {
    const response = await fetch("https://srmacaback.fly.dev/user/", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      credentials: "include",
    });
    const data = await response.json();
    return data;
  }
  const data = await GetUser();

  async function GetUserVouchers() {
    // const response = await fetch("http://localhost:8080/voucher/user/", {
    const response = await fetch("https://srmacaback.fly.dev/voucher/user/", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      credentials: "include",
    });
    const data = await response.json();
    return data;
  }

  const dataVouchers = await GetUserVouchers();
  console.log(dataVouchers);
  function fillProfile(data) {
    infoContainer.innerHTML = `
    <ul class="text-white [&>li>h3]:underline">
      <li>
        <h3>Nombre</h3>
        <p>${data.user.username}</p>
      </li>
      <li>
        <h3>Correo</h3>
        <p>${data.user.email}</p>
      </li>
      <li>
        <h3>Creaste tu cuenta el:</h3>
        <p>${formatDate(data.user.CreatedAt)}</p>
      </li>
    </ul>
      `;
  }

  function fillVouchers(data) {
    data.map((item) => {
      voucherContainer.innerHTML += `
      <div class="flex flex-col text-left justify-center bg-white rounded-md text-black shadow-md p-4 m-4">
        <h3 class="text-xl font-bold">Voucher</h3>
        <p class="text-lg font-bold">${item.Users.email}</p>
        <p class="text-lg font-bold">${item.glosa}</p>
        <img class="h-36 w-auto" src="https://srmacaback.fly.dev/voucher/images/${
          item.ID
        }" alt="Voucher Image - ${item.ID}" class="voucher-image">
        <p class="text-lg font-bold">${formatDate(item.CreatedAt)}</p>
        <p> <span class="font-bold">Estado:</span> ${
          item.status ? "Confirmado" : "No confirmado"
        }</p> 
      </div>
      `;
    });
  }

  fillProfile(data);
  fillVouchers(dataVouchers);
</script>

<!-- Estilos de la pagina -->
<style>
  #voucher-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 1rem; 
  }
</style>